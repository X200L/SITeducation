# Гайд по platformio IDE 
Привет! Статейка будет не такой уж короткой, но зато максимально практичной — с акцентом на то, **как настроить PlatformIO в VS Code и начать писать код для микроконтроллеров.**

А заодно разберёмся, что вообще такое PlatformIO, зачем он нужен и почему это лучше, чем Arduino IDE.

## А что вообще за PlatformIO?

Начнём с малого — теории. Но не переживайте, ее будет минимум и все по делу.

**PlatformIO** — это не просто IDE, а целая экосистема для разработки под микроконтроллеры. Представьте себе Arduino IDE, но **мощнее и гибче**. При этом работает на Windows, macOS и Linux — и всё это встраивается прямо в **Visual Studio Code**, который уже любят миллионы разработчиков.

### Ключевые преимущества PlatformIO перед Arduino IDE:

*   **Огромная база платформ и фреймворков:** Поддержка более 1500 отладочных плат и МК и более 13000 библиотек! Вы можете использовать не только Arduino (AVR), но и ESP-IDF (для ESP32), Mbed OS (для STM32, NXP), FreeRTOS и многие другие фреймворки. Больше не нужно искать "ссылки для менеджера плат" — всё есть из коробки.
*   **Невероятная скорость компиляции:** PlatformIO собирает проект иначе, что даёт огромный прирост скорости. Например, проект для ESP32 в Arduino IDE может компилироваться минуту, а в PlatformIO — всего 3-4 секунды!
*   **Изоляция зависимостей проекта:** В Arduino IDE есть одна общая папка с библиотеками. В PlatformIO библиотеки устанавливаются в папку конкретного проекта (.pio/libdeps/). Вы можете указать точную версию каждой библиотеки прямо в конфигурационном файле, и они не будут пересекаться с другими вашими проектами.


## Установка PlatformIO в VS Code: пошагово, как для новичка

Для начала установим platformioIDE с самого начала

### Шаг 1: Убедитесь, что у вас есть VS Code

Если вы его ещё не установили — бегом на [code.visualstudio.com](https://code.visualstudio.com/), качайте и ставьте.  
Это не Visual Studio, а лёгкий, быстрый и крутой редактор.


### Шаг 2: Устанавливаем PlatformIO IDE

Открываем VS Code → жмём `Ctrl+Shift+X` (или `Cmd+Shift+X` на Mac) → в поиске пишем **"PlatformIO IDE"**.

Ищем вот это:

![platformioex.png](images/platformioex.png)

Жмём **Install**.

Дождитесь завершения установки. В фоне PlatformIO установит Python-зависимости, скачает необходимые компиляторы (avr-gcc, xtensa, arm-none-eabi и т.д.) и настроит окружение. После установки вы увидите новую иконку в виде головы робота в левой панели — это и есть PlatformIO.

После установки вы увидите новую иконку в левой панели — прешельца. Это и есть PlatformIO.
### Шаг 3 (Опционально): Установите Git

Для работы с библиотеками напрямую из GitHub репозиториев желательно установить Git. Скачайте его с [официального сайта](https://git-scm.com/) и установите.

## Создаём первый проект

Теперь давайте сделаем что-то простое. Сделаем класический блинк.

1. Нажимаем на иконку PlatformIO.


2. В панели слева выбираем **"New Project"**.

![platformioex.png](images/platformio.png)

3. Заполняем:
   - **Project Name**: `Blink`
   - **Board**: выберите свою плату (например, `Arduino Uno`, `ESP32 Dev Module`)
   - **Framework**: `Arduino` (пока что)

![platformioex.png](images/platformioplatform.png)

4. Нажимаем **Finish** и выбираем папку для проекта.


## Что у нас появилось?

Открываем папку проекта. Вот что вы увидите:

![base](images/platformiobasecode.png)

Файл `src/main.cpp` — это ваш код. Он уже содержит шаблон, мы пишем туда класический блинк

```cpp
#include "Arduino"

void setup() {
pinMode(8,OUTPUT);
}
void loop (){
 digitalWrite(8, HIGH);
 delay(1000);
 digitalWrite(8< LOW);
 delay(1000);
}

```

## Подключаем плату и заливаем код

1.  Подключите вашу плату к компьютеру через USB.
2.  Убедитесь, что в статус-баре внизу выбрано правильное окружение (например, `env:uno`).
3.  PlatformIO часто сам определяет порт. Если нет — кликните на строку `COMx` в статус-баре и выберите нужный порт из списка.
   
![base](images/platformiocode1.png)

4.  В нижней панели управления жмём кнопку **→ Upload** (стрелка вправо) или используем горячие клавиши `Ctrl+Alt+U`.

![Кнопка загрузки](images/pltup.png)

Процесс сборки и загрузки будет отображаться в терминале. Если всё прошло успешно — вы увидите сообщение `SUCCESS` и светодиод на плате начнёт мигать.

![Мигающий светодиод](images/IMG_07052.gif)

**Если возникла ошибка, проверьте:**
*   Правильно ли выбрана плата в `platformio.ini`.
*   Определяется ли плата в системе (Диспетчер устройств на Windows, `ls /dev/tty*` на Linux/Mac).
*   Установлены ли драйверы для вашей платы (например, CH340 для китайских клонов Arduino).

## Platformio.ini

Теперь давайте одним глазком заглянем в файл platformio.ini. В этом файле прописываются все настройки проекта: платформа, плата, фреймворк, настройки конкретной платы, список библиотек и так далее. Файл позволяет создать в одном проекте несколько "рабочих сред" - окружений (environment, env). Каждое окружение - это конкретная плата со своими настройками, таким образом можно одновременно разрабатывать проект под несколько разных плат и быстро переключаться между ними.

Настройки окружения прописываются после тега [env:имя_окружения], а просто [env] задаёт общие настройки для всех окружений. Например так - общая скорость монитора для всех, фреймворк - Ардуино, список библиотек. Далее идут конкретные платы со своими настройками. Пример:
```
; platformio.ini
[env]
framework = arduino
monitor_speed = 115200
lib_deps = ; список библиотек

[env:nano328new]
platform = atmelavr
board = nanoatmega328new

[env:nano328]
platform = atmelavr
board = nanoatmega328
```

## Установка библиотек

Забудьте о ручном скачивании ZIP-архивов с GitHub и копировании их в папку `libraries`. В PlatformIO всё управляется  через файл `platformio.ini`.

Просто добавьте секцию `lib_deps` (library dependencies) в ваш `platformio.ini`:

```ini
[env:uno]
platform = atmelavr
board = uno
framework = arduino
lib_deps = 
    adafruit/Adafruit SSD1306@^2.4.3 ; Имя из реестра PIO + версия
    knolleary/PubSubClient@^2.8 ; Клиент MQTT
    https://github.com/GyverLibs/GyverOLED.git ; Прямая ссылка на GitHub
    https://github.com/bblanchon/ArduinoJson.git#v7.0.4 ; Ссылка на GitHub с указанием версии
```

При следующей сборке PlatformIO автоматически скачает все указанные библиотеки в папку проекта `.pio/libdeps/<имя_окружения>/`. Автодополнение и подсветка синтаксиса заработают сразу.

**Способы указания библиотек:**
*   **Из реестра PIO:** `ИмяАвтора/НазваниеБиблиотеки` (можно найти через встроенный поиск в PIO Home).
*   **Из реестра с версией:** `ИмяАвтора/НазваниеБиблиотеки@^1.2.3` (семантическое версионирование).
*   **Прямая ссылка на GitHub:** `https://github.com/username/repo.git`.
*   **Ссылка на конкретную версию:** `https://github.com/username/repo.git#v1.2.3`.
*   **Локальная библиотека:** Создайте папку `lib` в проекте и положите туда библиотеку. PlatformIO автоматически подхватит её.

> **Важно:** PlatformIO компилирует *все* исходные файлы (.cpp) в папках библиотек, даже если они не используются в проекте. Если библиотека платформо-зависима и не подключена в коде, это может вызвать ошибку. Поэтому подключайте в `lib_deps` только те библиотеки, которые вам реально нужны.
---

## Работа с несколькими платами

Представьте: вы пишете один проект, но хотите собрать его и для Arduino, и для ESP32.

В `platformio.ini` просто добавляете несколько окружений:

```ini
[env:uno]
platform = atmelavr
board = uno
framework = arduino

[env:esp32]
platform = espressif32
board = esp32dev
framework = arduino
```

Теперь вы можете:
- Выбрать нужное окружение в меню
- Собрать и залить код под разные платы
- Использовать разные настройки (скорость, флаги)

## Немного про platformio core
Нужно ли стаивть его отдельно? - НЕТ!
**PlatformIO Core** — это **движок**, который всё и делает: собирает, заливает, отлаживает.

Но!  
Когда вы ставите **расширение в VS Code** — **оно само устанавливает Core** в изолированной папке (`~/.platformio/`).

То есть:

 **Вам НЕ нужно вручную ставить `platformio` через `pip`**, если вы работаете в VS Code.

Только если:
- Вы используете **другой редактор** (Vim, Sublime и т.д.)
- Или хотите запускать сборку в **терминале** или **CI/CD**

Тогда:

```bash
pip install platformio
```

Но для 95% пользователей — **достаточно расширения в VS Code**.

## Полезные советы и "подводные камни"

*   **Монитор порта:** Встроенный монитор порта в PlatformIO иногда может глючить. Если нужно что-то посерьёзнее, можно использовать монитор из Arduino IDE или сторонние программы like Putty, CoolTerm.
*   **Плоттер:** Встроенного плоттера для графиков нет, но есть сторонние расширения для VS Code или используйте плоттер из Arduino IDE.
*   **Если что-то пошло не так:** Часто проблемы (например, ошибка `unknown package` или сбой при переключении окружения) решаются простым **перезапуском VS Code**. В более сложных случаях помогает удаление папки `.pio` в проекте (она пересоздаётся при следующей сборке) — это заставит PIO заново скачать все зависимости.
*   **Горячие клавиши:**
    *   `Ctrl+Alt+B` — Скомпилировать проект.
    *   `Ctrl+Alt+U` — Загрузить прошивку на плату.
    *   `Ctrl+Alt+S` — Открыть монитор последовательного порта.
    *   `Alt+Shift+F` — Автоформатирование кода.

## Заключение

PlatformIO — это современный, мощный и профессиональный инструмент, который делает разработку для микроконтроллеров гораздо приятнее и эффективнее. Он требует чуть больше первоначальных усилий для понимания, чем Arduino IDE, но эти усилия окупаются сторицей на любом более-менее серьёзном проекте.

**Выгоды очевидны:** скорость, порядок в зависимостях, портативность, отладка и автоматизация. Это следующий логичный шаг для любого разработчика, выросшего из Arduino IDE.

---

## Полезные ссылки

*   [Официальный сайт PlatformIO](https://platformio.org/)
*   [Документация PlatformIO](https://docs.platformio.org/) 
*   [Список поддерживаемых плат](https://platformio.org/boards)
*   [Сообщество PlatformIO](https://community.platformio.org/)
*   [Статья от Гайвера](https://alexgyver.ru/lessons/platformio/)
